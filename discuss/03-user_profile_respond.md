# 回复 02-user_profile_discussion

## 1. 架构和技术栈方面

### 1.1 引入新的数据库依赖

采用PostgreSQL + MongoDB，所有之前提到的mysql均改为采用PostgreSQL

## 2. 与现有 mem0 框架的集成

### 2.1 配置管理

现在的pg配置在哪里？现在只需要新增一个mongo的配置，和pg的配置放到一起即可

### 2.2 接口位置

和现有的接口分开，单独做一个类

其实关于这个userprofile，我一开始都想专门起一个单独的服务，但我想着能减少一点部署成本和容器之间沟通的成本，所以就索性一起放到mem0中了

这里也可以和你讨论，你觉得放一个mem0中好，还是干脆起一个新的服务好？

## 3. 数据模型设计细节

### 3.1 user_id 的一致性

只支持 user_id 即可

### 3.2 词汇表的 level 枚举值

unknown不需要了吧，如果不知道这个单词，就不要出现这条记录就行了

至于你说的forgotten，给大模型判断准确吗？我不太确定，包括是否要增加更多状态，我
感觉会增加prompt的复杂性，并且由于llm本来就是有随机性的，我觉得会让系统难以维护。
你觉得呢？

### 3.3 词汇的 count 字段语义

count就作为练习次数吧。

出现次数我觉得没有太大意义，增加维护的成本

## 4. LLM 调用和提示词

### 4.1 并行调用两个 LLM 的成本

当时我之所以想分成两个，是因为这两个是没有太多交集的，所以比较好分开，
但是现在我重新想了一下他的基本信息，其实变化并不会特别大，
所以如果只用一个大模型来生成的话，那就可以更加侧重提取他的拓展信息。

然后关于基本信息为有两个想法，第一个就是比如一些最基本的信息，
比如昵称年龄这些其实是可以在前端界面要求用户输入的，并且用户也可以自己修改，
那么这部分信息我们是否还需要收集呢？还是直接读取他的一个信息，
但是还有一些没有那么主要的信息，比如说家乡时区等等，如果要求用户全部填写是否会太麻烦，
我的想法是最最基本的信息，可能可以直接从清单读取，但还有一些衍生的信息，
但也是属于基本信息，是不是就以单独从绘画中提取为主？

第二个想法就是关于刚刚说的，如果只有一个大模型来提取所有的信息，这些基本的信息更新的频率不高，
但是还是会有可能更新的，那么面对这种发生情况非常少，但是要考虑到的场景怎么办？

### 4.2 提示词设计

关于提示词，我的意思就是借鉴他的设计方法，并不是说直接用他的提示词
因为他的提示词，我发现在测试中效果还可以，所以希望可以参考现有的这个设计，而不是从零开始

另外，你提到的关于年龄增长的问题，我觉得就取消掉年龄这个阶段保留一个生日就可以了

关于兴趣的变化，我觉得除非他之前说对某个事情很感兴趣之后明确说了，
对这个事情不再感兴趣了，那这种情况下就进行一个更新，否则他增加新的兴趣就对比下数据库，
如果之前没有存储过，那就作为新增来处理

所以兴趣的更新是需要结合语意的，所以需要llm判断，也需要你参考mem0的prompt

## 5. 接口参数和返回值

### 5.1 set_profile 的输入

接收 user_id 和 messages

经过之前的讨论，我们认定就只调用一次大模型，且这个大模型的侧重点在于一些非结构化的阶段，所以这个必须从语义来提取

### 5.2 get_profile 的 type 参数

同意，type可以修改使其更加语义化，但对外接口数量保持不变

### 5.3 get_vocab 的 filter 参数

单词的存储，我们最终就用P G来存就好了，他因为是结构化的，然后我们也不用mysql了

## 6. 性能和扩展性

### 6.1 词汇表的规模

这里我也没特别的想清楚，因为一个用户虽说能掌握的词汇量非常多，但其实每一条数据它的数据量都不会特别的大，
然后我也不清楚会不会有一个场景，就是需要用户所掌握的所有词汇量这个场景，我觉得先考虑按照分页来做吧

### 6.2 并发更新

现在我们还在MVP阶段，所以并发就暂时不考虑了
当然，如果只是非常简单的一个语句，比如说增加一个原子操作，我觉得加上就加上吧，也无所谓

## 7. Docker 和部署

### 7.1 docker-compose 配置

这个我们就定好了，增加一个Mongo的容器

数据的持久话就常规处理啊，肯定是要把它通过这个volume映射出来

### 7.2 数据库迁移

我理解按照现在我们的方案原有的表结构都不需要变化，我们倒是需要新增一些表

然后你指的数据库的迁移是指新的这些表的牵引吗？如果是新的表就用常规方法呀，比如我之前在Golan这个语言的时候就用ORM来进行表的数据迁移。

## 8. 测试和验证

### 8.1 测试数据

测试的话，我觉得只有把这些接口都写出来之后，我到时候直接测试的接口吧，人工测，然后也可能会叫你给我生成一些数据去测，我觉得这个问题不大

## 9. 其他问题

### 9.1 删除操作

用户信息错误，它有一个更新的机制呀，我删除是没必要删除的，因为我年龄在这儿了，我干吗把它删掉呢，我无非就是更新，而且我们刚才讨论年龄就不存清楚的生日就可以了

### 9.2 隐私和安全

暂不考虑，但以后要做，提醒我！！！

### 9.3 与现有 memories 的关系

互补的（部分重叠）

我的想法就是两个系统各做各的兴趣那边正常增加，比如说喜欢足球，然后画像这边也给他增加进去